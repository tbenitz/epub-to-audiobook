// Wait until the page is fully loaded
document.addEventListener("DOMContentLoaded", () => {
  const fileInput = document.getElementById("epubInput");
  const dropZone = document.getElementById("dropZone");

  if (fileInput) {
    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) handleEpubFile(file);
    });
  }

  if (dropZone) {
    dropZone.addEventListener("click", () => fileInput?.click());

    ["dragover", "dragenter"].forEach(ev => {
      dropZone.addEventListener(ev, e => {
        e.preventDefault();
        dropZone.classList.add("dragging");
      });
    });

    ["dragleave", "dragend", "drop"].forEach(ev => {
      dropZone.addEventListener(ev, e => {
        e.preventDefault();
        dropZone.classList.remove("dragging");
      });
    });

    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      const file = Array.from(e.dataTransfer.files).find(f =>
        f.name.toLowerCase().endsWith(".epub")
      );
      if (file) handleEpubFile(file);
      else setStatus("Please drop an .epub file");
    });
  }

  // Rest of your event listeners (chapterSelect, playPause, etc.)
  document.getElementById("chapterSelect")?.addEventListener("change", e => {
    if (e.target.value) loadChapter(e.target.value);
  });

  document.getElementById("playPause")?.addEventListener("click", () => {
    if (speechSynthesis.paused) {
      speechSynthesis.resume();
    } else if (speechSynthesis.speaking) {
      speechSynthesis.pause();
    }
    // (or use the improved version from my previous answer)
  });

  document.getElementById("stop")?.addEventListener("click", stop);

  // rate display
  const rateInput = document.getElementById("rate");
  const rateValue = document.getElementById("rateValue");
  rateInput?.addEventListener("input", () => {
    rateValue.textContent = (parseFloat(rateInput.value) || 1).toFixed(1) + "Ã—";
  });
});
